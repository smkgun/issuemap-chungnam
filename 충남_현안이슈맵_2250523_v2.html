<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì¶©ì²­ë‚¨ë„ ì‹œêµ°êµ¬ í˜„ì•ˆ ì´ìŠˆì§€ë„</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 0;
      background: white;
    }
    
    header {
      padding: 16px;
      background: #1a4e8e;
      color: white;
      font-size: 1.3rem;
      text-align: center;
      font-weight: 700;
    }
    
    #controls {
      padding: 15px;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
    }
    
    #region-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 10px;
    }
    
    #region-buttons button {
      padding: 8px 16px;
      font-size: 13px;
      border: 1px solid #ccc;
      background-color: white;
      cursor: pointer;
      border-radius: 4px;
      transition: all 0.2s;
      font-family: 'Noto Sans KR', sans-serif;
    }
    
    #region-buttons button:hover {
      background-color: #1a4e8e;
      color: white;
    }
    
    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      font-size: 12px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .legend-color {
      width: 20px;
      height: 15px;
      border: 1px solid #333;
    }
    
    #map {
      width: 100%;
      height: calc(100vh - 180px);
    }
    
    .popup-content {
      font-size: 14px;
      line-height: 1.6;
      max-width: 350px;
    }
    
    .popup-content h3 {
      margin: 0 0 10px 0;
      color: #1a4e8e;
      font-size: 16px;
    }
    
    .popup-content ul {
      padding-left: 0;
      margin: 10px 0;
      list-style: none;
    }
    
    .popup-content li {
      margin-bottom: 8px;
      padding: 8px 12px;
      background: #f8f9fa;
      border-radius: 6px;
      border-left: 3px solid #1a4e8e;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    
    .popup-content li:hover {
      background: #e3f2fd;
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .popup-content li::after {
      content: 'ğŸ”—';
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      opacity: 0.6;
    }
    
    .popup-content .importance {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
      color: white;
      margin-bottom: 12px;
    }
    
    .importance.ë†’ìŒ { background-color: #e53e3e; }
    .importance.ì¤‘ê°„ { background-color: #f6ad55; color: #333; }
    .importance.ë‚®ìŒ { background-color: #68d391; color: #333; }
    
    .issue-help {
      font-size: 11px;
      color: #666;
      margin-top: 8px;
      font-style: italic;
      text-align: center;
    }
  </style>
</head>
<body>
  <header>
    ì¶©ì²­ë‚¨ë„ ì‹œêµ°êµ¬ í˜„ì•ˆ ì´ìŠˆ ì§€ë„
  </header>
  
  <div id="controls">
    <div id="region-buttons"></div>
    <div class="legend">
      <div class="legend-item">
        <div class="legend-color" style="background-color: #e53e3e;"></div>
        <span>ë†’ìŒ</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #f6ad55;"></div>
        <span>ì¤‘ê°„</span>
      </div>
      <div class="legend-item">
        <div class="legend-color" style="background-color: #68d391;"></div>
        <span>ë‚®ìŒ</span>
      </div>
    </div>
  </div>
  
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <script>
    let issueData = {};
    let csvRawData = [];

    // ì§€ë„ ì´ˆê¸°í™”
    const map = L.map('map', {
      zoomControl: true,
      attributionControl: true
    }).setView([36.5, 126.8], 9);

    // ë°°ê²½ íƒ€ì¼ ì¶”ê°€
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    const regionLayers = {};
    let allRegions = [];

    // CSV íŒŒì¼ ì½ê¸° ë° ë°ì´í„° ì²˜ë¦¬
    async function loadCSVData() {
      try {
        const csvContent = await window.fs.readFile('chungnam_issues_with_naver_links.csv', { encoding: 'utf8' });
        
        Papa.parse(csvContent, {
          header: true,
          skipEmptyLines: true,
          complete: function(results) {
            console.log('CSV ë°ì´í„° ë¡œë“œ ì™„ë£Œ:', results.data);
            csvRawData = results.data;
            
            results.data.forEach(row => {
              if (row.ì‹œêµ°ëª…) {
                const cleanedRow = {};
                Object.keys(row).forEach(key => {
                  cleanedRow[key.trim()] = row[key] ? row[key].toString().trim() : '';
                });
                
                issueData[cleanedRow.ì‹œêµ°ëª…] = {
                  ì¤‘ìš”ë„: cleanedRow.ì¤‘ìš”ë„ || 'ì¤‘ê°„',
                  ì£¼ìš”ì´ìŠˆ: cleanedRow.ì£¼ìš”ì´ìŠˆ ? cleanedRow.ì£¼ìš”ì´ìŠˆ.split('|') : [],
                  ì¶œì²˜: cleanedRow.ì¶œì²˜ || null,
                  ì´ìŠˆ1: cleanedRow.ì´ìŠˆ1 || '',
                  ì´ìŠˆ1_ë§í¬: cleanedRow['ì´ìŠˆ1_ë§í¬'] || '',
                  ì´ìŠˆ2: cleanedRow.ì´ìŠˆ2 || '',
                  ì´ìŠˆ2_ë§í¬: cleanedRow['ì´ìŠˆ2_ë§í¬'] || '',
                  ì´ìŠˆ3: cleanedRow.ì´ìŠˆ3 || '',
                  ì´ìŠˆ3_ë§í¬: cleanedRow['ì´ìŠˆ3_ë§í¬'] || ''
                };
              }
            });
            
            console.log('ì²˜ë¦¬ëœ ì´ìŠˆ ë°ì´í„°:', issueData);
            drawRegions();
          },
          error: function(error) {
            console.error('CSV íŒŒì‹± ì˜¤ë¥˜:', error);
            loadFallbackData();
          }
        });
      } catch (error) {
        console.error('CSV íŒŒì¼ ì½ê¸° ì˜¤ë¥˜:', error);
        loadFallbackData();
      }
    }

    // ëŒ€ì²´ ë°ì´í„° (CSV ì½ê¸° ì‹¤íŒ¨ì‹œ)
    function loadFallbackData() {
      issueData = {
        'ì²œì•ˆì‹œ': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ë¯¸ë˜ëª¨ë¹Œë¦¬í‹° êµ­ê°€ì‚°ë‹¨ ì¡°ì„±', 'êµ­ê°€ AI ì»´í“¨íŒ…ì„¼í„° ìœ ì¹˜', 'êµ­ë¦½ì¹˜ì˜í•™ì—°êµ¬ì›Â·ì´ë¯¼ì²­ ì„¤ë¦½'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ë¯¸ë˜ëª¨ë¹Œë¦¬í‹° êµ­ê°€ì‚°ë‹¨ ì¡°ì„±',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì²œì•ˆì‹œ ë¯¸ë˜ëª¨ë¹Œë¦¬í‹° êµ­ê°€ì‚°ë‹¨ ì¡°ì„±',
          ì´ìŠˆ2: 'êµ­ê°€ AI ì»´í“¨íŒ…ì„¼í„° ìœ ì¹˜',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì²œì•ˆì‹œ êµ­ê°€ AI ì»´í“¨íŒ…ì„¼í„° ìœ ì¹˜',
          ì´ìŠˆ3: 'êµ­ë¦½ì¹˜ì˜í•™ì—°êµ¬ì›Â·ì´ë¯¼ì²­ ì„¤ë¦½',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì²œì•ˆì‹œ êµ­ë¦½ì¹˜ì˜í•™ì—°êµ¬ì›Â·ì´ë¯¼ì²­ ì„¤ë¦½'
        },
        'ê³µì£¼ì‹œ': {
          ì¤‘ìš”ë„: 'ì¤‘ê°„',
          ì£¼ìš”ì´ìŠˆ: ['ë†ì´Œ í™œë ¥ ë° ì •ì£¼ ì¸í”„ë¼ ê°•í™”', 'ë°±ì œë¬¸í™” ê´€ê´‘ í™œì„±í™”', 'êµìœ¡Â·ì‚°ë‹¨ ìœ ì¹˜ ëª¨ìƒ‰'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ë†ì´Œ í™œë ¥ ë° ì •ì£¼ ì¸í”„ë¼ ê°•í™”',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ê³µì£¼ì‹œ ë†ì´Œ í™œë ¥ ë° ì •ì£¼ ì¸í”„ë¼ ê°•í™”',
          ì´ìŠˆ2: 'ë°±ì œë¬¸í™” ê´€ê´‘ í™œì„±í™”',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ê³µì£¼ì‹œ ë°±ì œë¬¸í™” ê´€ê´‘ í™œì„±í™”',
          ì´ìŠˆ3: 'êµìœ¡Â·ì‚°ë‹¨ ìœ ì¹˜ ëª¨ìƒ‰',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ê³µì£¼ì‹œ êµìœ¡Â·ì‚°ë‹¨ ìœ ì¹˜ ëª¨ìƒ‰'
        },
        'ë³´ë ¹ì‹œ': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ì›ì‚°ë„~íš¨ìë„ ì—°ë„êµ ê±´ì„¤', 'í•´ì–‘ë ˆí¬ì¸ ì„¼í„° ë° ê´€ê´‘ ì¸í”„ë¼', 'ì‹ ì‚°ì—… R&Dì„¼í„° ìœ ì¹˜'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ì›ì‚°ë„~íš¨ìë„ ì—°ë„êµ ê±´ì„¤',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë³´ë ¹ì‹œ ì›ì‚°ë„~íš¨ìë„ ì—°ë„êµ ê±´ì„¤',
          ì´ìŠˆ2: 'í•´ì–‘ë ˆí¬ì¸ ì„¼í„° ë° ê´€ê´‘ ì¸í”„ë¼',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë³´ë ¹ì‹œ í•´ì–‘ë ˆí¬ì¸ ì„¼í„° ë° ê´€ê´‘ ì¸í”„ë¼',
          ì´ìŠˆ3: 'ì‹ ì‚°ì—… R&Dì„¼í„° ìœ ì¹˜',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë³´ë ¹ì‹œ ì‹ ì‚°ì—… R&Dì„¼í„° ìœ ì¹˜'
        },
        'ì„œì‚°ì‹œ': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ì„œì‚°ê³µí•­ ê±´ì„¤', 'ê°€ë¡œë¦¼ë§Œ êµ­ê°€í•´ì–‘ì •ì› ì¡°ì„±', 'ë¬¸í™”ê´€ê´‘ ì½˜í…ì¸  ìœ¡ì„±'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ì„œì‚°ê³µí•­ ê±´ì„¤',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì„œì‚°ì‹œ ì„œì‚°ê³µí•­ ê±´ì„¤',
          ì´ìŠˆ2: 'ê°€ë¡œë¦¼ë§Œ êµ­ê°€í•´ì–‘ì •ì› ì¡°ì„±',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì„œì‚°ì‹œ ê°€ë¡œë¦¼ë§Œ êµ­ê°€í•´ì–‘ì •ì› ì¡°ì„±',
          ì´ìŠˆ3: 'ë¬¸í™”ê´€ê´‘ ì½˜í…ì¸  ìœ¡ì„±',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì„œì‚°ì‹œ ë¬¸í™”ê´€ê´‘ ì½˜í…ì¸  ìœ¡ì„±'
        },
        'ë…¼ì‚°ì‹œ': {
          ì¤‘ìš”ë„: 'ì¤‘ê°„',
          ì£¼ìš”ì´ìŠˆ: ['ë°˜ë‹¤ë¹„ì²´ìœ¡ì„¼í„° ê±´ë¦½', 'ì¬í•´ë°©ì§€ ê¸°ë°˜ì‹œì„¤ ë³´ê°•', 'ìë©´ ì¬ìƒì‚¬ì—…'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ë°˜ë‹¤ë¹„ì²´ìœ¡ì„¼í„° ê±´ë¦½',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë…¼ì‚°ì‹œ ë°˜ë‹¤ë¹„ì²´ìœ¡ì„¼í„° ê±´ë¦½',
          ì´ìŠˆ2: 'ì¬í•´ë°©ì§€ ê¸°ë°˜ì‹œì„¤ ë³´ê°•',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë…¼ì‚°ì‹œ ì¬í•´ë°©ì§€ ê¸°ë°˜ì‹œì„¤ ë³´ê°•',
          ì´ìŠˆ3: 'ìë©´ ì¬ìƒì‚¬ì—…',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë…¼ì‚°ì‹œ ìë©´ ì¬ìƒì‚¬ì—…'
        },
        'ì•„ì‚°ì‹œ': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ë””ìŠ¤í”Œë ˆì´ í´ëŸ¬ìŠ¤í„° ì¡°ì„±', 'íƒ•ì •ì‹ ë„ì‹œ ì£¼ê±°ë‹¨ì§€ ê°œë°œ', 'ì‚°ì—…ë‹¨ì§€ ë° ê¸°ì—…ìœ ì¹˜'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ë””ìŠ¤í”Œë ˆì´ í´ëŸ¬ìŠ¤í„° ì¡°ì„±',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì•„ì‚°ì‹œ ë””ìŠ¤í”Œë ˆì´ í´ëŸ¬ìŠ¤í„° ì¡°ì„±',
          ì´ìŠˆ2: 'íƒ•ì •ì‹ ë„ì‹œ ì£¼ê±°ë‹¨ì§€ ê°œë°œ',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì•„ì‚°ì‹œ íƒ•ì •ì‹ ë„ì‹œ ì£¼ê±°ë‹¨ì§€ ê°œë°œ',
          ì´ìŠˆ3: 'ì‚°ì—…ë‹¨ì§€ ë° ê¸°ì—…ìœ ì¹˜',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì•„ì‚°ì‹œ ì‚°ì—…ë‹¨ì§€ ë° ê¸°ì—…ìœ ì¹˜'
        },
        'ë‹¹ì§„ì‹œ': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['êµ­ë„32í˜¸ ëŒ€ì²´ìš°íšŒë„ë¡œ ê°œì„¤', 'ìˆ˜ì‚°ì‹í’ˆí´ëŸ¬ìŠ¤í„° ì¡°ì„±', 'ê¸°ì—…í˜ì‹ íŒŒí¬ ë° í•´ì–‘ê´€ê´‘ë‹¨ì§€ êµ¬ì¶•'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'êµ­ë„32í˜¸ ëŒ€ì²´ìš°íšŒë„ë¡œ ê°œì„¤',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë‹¹ì§„ì‹œ êµ­ë„32í˜¸ ëŒ€ì²´ìš°íšŒë„ë¡œ ê°œì„¤',
          ì´ìŠˆ2: 'ìˆ˜ì‚°ì‹í’ˆí´ëŸ¬ìŠ¤í„° ì¡°ì„±',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë‹¹ì§„ì‹œ ìˆ˜ì‚°ì‹í’ˆí´ëŸ¬ìŠ¤í„° ì¡°ì„±',
          ì´ìŠˆ3: 'ê¸°ì—…í˜ì‹ íŒŒí¬ ë° í•´ì–‘ê´€ê´‘ë‹¨ì§€ êµ¬ì¶•',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë‹¹ì§„ì‹œ ê¸°ì—…í˜ì‹ íŒŒí¬ ë° í•´ì–‘ê´€ê´‘ë‹¨ì§€ êµ¬ì¶•'
        },
        'ê¸ˆì‚°êµ°': {
          ì¤‘ìš”ë„: 'ì¤‘ê°„',
          ì£¼ìš”ì´ìŠˆ: ['ì¸êµ¬ìœ ì… ë° ê·€ë† ì§€ì›', 'ê³ í’ˆì§ˆ ë†ì—…Â·ë†ì´Œì²´í—˜', 'ë„ë¡œÂ·ì •ì£¼ ì¸í”„ë¼ ì •ë¹„'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ì¸êµ¬ìœ ì… ë° ê·€ë† ì§€ì›',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ê¸ˆì‚°êµ° ì¸êµ¬ìœ ì… ë° ê·€ë† ì§€ì›',
          ì´ìŠˆ2: 'ê³ í’ˆì§ˆ ë†ì—…Â·ë†ì´Œì²´í—˜',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ê¸ˆì‚°êµ° ê³ í’ˆì§ˆ ë†ì—…Â·ë†ì´Œì²´í—˜',
          ì´ìŠˆ3: 'ë„ë¡œÂ·ì •ì£¼ ì¸í”„ë¼ ì •ë¹„',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ê¸ˆì‚°êµ° ë„ë¡œÂ·ì •ì£¼ ì¸í”„ë¼ ì •ë¹„'
        },
        'ì„œì²œêµ°': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ì¥í•­í•­ ìˆ˜ì‚°ì»´í”Œë ‰ìŠ¤ ì¡°ì„±', 'í™ì›í•­ ë³µí•©ê°œë°œ', 'í•´ì–‘ìƒíƒœê³„ ë³´ì „'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ì¥í•­í•­ ìˆ˜ì‚°ì»´í”Œë ‰ìŠ¤ ì¡°ì„±',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì„œì²œêµ° ì¥í•­í•­ ìˆ˜ì‚°ì»´í”Œë ‰ìŠ¤ ì¡°ì„±',
          ì´ìŠˆ2: 'í™ì›í•­ ë³µí•©ê°œë°œ',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì„œì²œêµ° í™ì›í•­ ë³µí•©ê°œë°œ',
          ì´ìŠˆ3: 'í•´ì–‘ìƒíƒœê³„ ë³´ì „',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì„œì²œêµ° í•´ì–‘ìƒíƒœê³„ ë³´ì „'
        },
        'ë¶€ì—¬êµ°': {
          ì¤‘ìš”ë„: 'ì¤‘ê°„',
          ì£¼ìš”ì´ìŠˆ: ['ê¸ˆê°• ëˆ„ì •Â·ì„ ìœ ê¸¸ ì¡°ì„±', 'ì‚¬ë¹„ë§ˆì„ ì´ì£¼ë‹¨ì§€ ë¶„ì–‘', 'ë¶€ì—¬ë„ì„œê´€ ì‹ ì¶•'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ê¸ˆê°• ëˆ„ì •Â·ì„ ìœ ê¸¸ ì¡°ì„±',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë¶€ì—¬êµ° ê¸ˆê°• ëˆ„ì •Â·ì„ ìœ ê¸¸ ì¡°ì„±',
          ì´ìŠˆ2: 'ì‚¬ë¹„ë§ˆì„ ì´ì£¼ë‹¨ì§€ ë¶„ì–‘',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë¶€ì—¬êµ° ì‚¬ë¹„ë§ˆì„ ì´ì£¼ë‹¨ì§€ ë¶„ì–‘',
          ì´ìŠˆ3: 'ë¶€ì—¬ë„ì„œê´€ ì‹ ì¶•',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ë¶€ì—¬êµ° ë¶€ì—¬ë„ì„œê´€ ì‹ ì¶•'
        },
        'ì²­ì–‘êµ°': {
          ì¤‘ìš”ë„: 'ì¤‘ê°„',
          ì£¼ìš”ì´ìŠˆ: ['ìŠ¤ë§ˆíŠ¸ APC êµ¬ì¶•', 'ì²­ë…„ ìŠ¤ë§ˆíŠ¸íŒœ í´ëŸ¬ìŠ¤í„°', 'ë…¸ì¸ëŒë´„ ì„œë¹„ìŠ¤ ê°•í™”'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ìŠ¤ë§ˆíŠ¸ APC êµ¬ì¶•',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì²­ì–‘êµ° ìŠ¤ë§ˆíŠ¸ APC êµ¬ì¶•',
          ì´ìŠˆ2: 'ì²­ë…„ ìŠ¤ë§ˆíŠ¸íŒœ í´ëŸ¬ìŠ¤í„°',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì²­ì–‘êµ° ì²­ë…„ ìŠ¤ë§ˆíŠ¸íŒœ í´ëŸ¬ìŠ¤í„°',
          ì´ìŠˆ3: 'ë…¸ì¸ëŒë´„ ì„œë¹„ìŠ¤ ê°•í™”',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì²­ì–‘êµ° ë…¸ì¸ëŒë´„ ì„œë¹„ìŠ¤ ê°•í™”'
        },
        'í™ì„±êµ°': {
          ì¤‘ìš”ë„: 'ë‚®ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['êµ°ì²­ì‚¬ ì‚¬ì—…ì¥ ì‹¤íƒœ ì ê²€', 'ë„ë¡œÂ·ë†ì´ŒÂ·ê´€ê´‘ ì¸í”„ë¼', 'ì£¼ë¯¼ì˜ê²¬ ìˆ˜ë ´ ë° ì±…ì„ì œ ë„ì…'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'êµ°ì²­ì‚¬ ì‚¬ì—…ì¥ ì‹¤íƒœ ì ê²€',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=í™ì„±êµ° êµ°ì²­ì‚¬ ì‚¬ì—…ì¥ ì‹¤íƒœ ì ê²€',
          ì´ìŠˆ2: 'ë„ë¡œÂ·ë†ì´ŒÂ·ê´€ê´‘ ì¸í”„ë¼',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=í™ì„±êµ° ë„ë¡œÂ·ë†ì´ŒÂ·ê´€ê´‘ ì¸í”„ë¼',
          ì´ìŠˆ3: 'ì£¼ë¯¼ì˜ê²¬ ìˆ˜ë ´ ë° ì±…ì„ì œ ë„ì…',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=í™ì„±êµ° ì£¼ë¯¼ì˜ê²¬ ìˆ˜ë ´ ë° ì±…ì„ì œ ë„ì…'
        },
        'ì˜ˆì‚°êµ°': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ì„œí•´ì„  ë³µì„ ì „ì²  ì—°ì¥', 'ì˜ˆë‹¹í˜¸ ê´€ê´‘ì¸í”„ë¼', 'ìÂ·ë©´ ì¤‘ì‹¬ì§€ í™œì„±í™”'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ì„œí•´ì„  ë³µì„ ì „ì²  ì—°ì¥',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì˜ˆì‚°êµ° ì„œí•´ì„  ë³µì„ ì „ì²  ì—°ì¥',
          ì´ìŠˆ2: 'ì˜ˆë‹¹í˜¸ ê´€ê´‘ì¸í”„ë¼',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì˜ˆì‚°êµ° ì˜ˆë‹¹í˜¸ ê´€ê´‘ì¸í”„ë¼',
          ì´ìŠˆ3: 'ìÂ·ë©´ ì¤‘ì‹¬ì§€ í™œì„±í™”',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=ì˜ˆì‚°êµ° ìÂ·ë©´ ì¤‘ì‹¬ì§€ í™œì„±í™”'
        },
        'íƒœì•ˆêµ°': {
          ì¤‘ìš”ë„: 'ë†’ìŒ',
          ì£¼ìš”ì´ìŠˆ: ['ê°€ë¡œë¦¼ë§Œ í•´ìƒêµëŸ‰ ê±´ì„¤', 'ê°€ë¡œë¦¼ë§Œ ê°¯ë²Œ ì„¸ê³„ìœ ì‚° ë“±ì¬', 'í•´ì•ˆì„ Â·ëª¨ë˜í†± ë³´ì „ ë° ê´€ê´‘ê°œë°œ'],
          ì¶œì²˜: null,
          ì´ìŠˆ1: 'ê°€ë¡œë¦¼ë§Œ í•´ìƒêµëŸ‰ ê±´ì„¤',
          ì´ìŠˆ1_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=íƒœì•ˆêµ° ê°€ë¡œë¦¼ë§Œ í•´ìƒêµëŸ‰ ê±´ì„¤',
          ì´ìŠˆ2: 'ê°€ë¡œë¦¼ë§Œ ê°¯ë²Œ ì„¸ê³„ìœ ì‚° ë“±ì¬',
          ì´ìŠˆ2_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=íƒœì•ˆêµ° ê°€ë¡œë¦¼ë§Œ ê°¯ë²Œ ì„¸ê³„ìœ ì‚° ë“±ì¬',
          ì´ìŠˆ3: 'í•´ì•ˆì„ Â·ëª¨ë˜í†± ë³´ì „ ë° ê´€ê´‘ê°œë°œ',
          ì´ìŠˆ3_ë§í¬: 'https://search.naver.com/search.naver?where=news&query=íƒœì•ˆêµ° í•´ì•ˆì„ Â·ëª¨ë˜í†± ë³´ì „ ë° ê´€ê´‘ê°œë°œ'
        }
      };
      
      console.log('ëŒ€ì²´ ë°ì´í„° ì‚¬ìš©:', issueData);
      drawRegions();
    }

    // ì¤‘ìš”ë„ë³„ ìƒ‰ìƒ ë°˜í™˜
    function getColorByImportance(importance) {
      switch(importance) {
        case 'ë†’ìŒ': return '#e53e3e';
        case 'ì¤‘ê°„': return '#f6ad55';
        case 'ë‚®ìŒ': return '#68d391';
        default: return '#gray';
      }
    }

    // ì´ìŠˆ í´ë¦­ í•¸ë“¤ëŸ¬
    function handleIssueClick(link, issueName) {
      if (link && link.trim()) {
        window.open(link, '_blank');
      } else {
        alert('í•´ë‹¹ ì´ìŠˆì˜ ë§í¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
      }
    }

    // íŒì—… ë‚´ìš© ìƒì„± (ë§í¬ í¬í•¨)
    function createPopupContent(name, data) {
      let issuesHtml = '';
      
      // ê° ì´ìŠˆë³„ë¡œ ë§í¬ì™€ í•¨ê»˜ í‘œì‹œ
      if (data.ì´ìŠˆ1) {
        issuesHtml += `<li onclick="handleIssueClick('${data.ì´ìŠˆ1_ë§í¬}', '${data.ì´ìŠˆ1}')" title="í´ë¦­í•˜ì—¬ ê´€ë ¨ ë‰´ìŠ¤ ë³´ê¸°">${data.ì´ìŠˆ1}</li>`;
      }
      if (data.ì´ìŠˆ2) {
        issuesHtml += `<li onclick="handleIssueClick('${data.ì´ìŠˆ2_ë§í¬}', '${data.ì´ìŠˆ2}')" title="í´ë¦­í•˜ì—¬ ê´€ë ¨ ë‰´ìŠ¤ ë³´ê¸°">${data.ì´ìŠˆ2}</li>`;
      }
      if (data.ì´ìŠˆ3) {
        issuesHtml += `<li onclick="handleIssueClick('${data.ì´ìŠˆ3_ë§í¬}', '${data.ì´ìŠˆ3}')" title="í´ë¦­í•˜ì—¬ ê´€ë ¨ ë‰´ìŠ¤ ë³´ê¸°">${data.ì´ìŠˆ3}</li>`;
      }
      
      // ë§í¬ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ì´ìŠˆ ëª©ë¡ ì‚¬ìš©
      if (!issuesHtml && data.ì£¼ìš”ì´ìŠˆ && data.ì£¼ìš”ì´ìŠˆ.length > 0) {
        issuesHtml = data.ì£¼ìš”ì´ìŠˆ.map(issue => `<li>${issue}</li>`).join('');
      }
      
      const sourceLink = data.ì¶œì²˜ ? `<small><a href='${data.ì¶œì²˜}' target='_blank'>[ì¶œì²˜ ë³´ê¸°]</a></small>` : '';
      
      return `
        <div class='popup-content'>
          <h3>${name}</h3>
          <div class='importance ${data.ì¤‘ìš”ë„}'>${data.ì¤‘ìš”ë„}</div>
          <strong>ì£¼ìš” í˜„ì•ˆ:</strong>
          <ul>${issuesHtml}</ul>
          ${issuesHtml ? '<div class="issue-help">ğŸ’¡ ê° ì´ìŠˆë¥¼ í´ë¦­í•˜ë©´ ê´€ë ¨ ë‰´ìŠ¤ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</div>' : ''}
          ${sourceLink}
        </div>
      `;
    }

    // ì§€ì—­ ë²„íŠ¼ ìƒì„±
    function renderRegionButtons(regions) {
      const container = document.getElementById("region-buttons");
      container.innerHTML = '';
      
      regions.sort().forEach(name => {
        const button = document.createElement("button");
        button.innerText = name;
        button.onclick = () => {
          const layer = regionLayers[name];
          if (layer) {
            map.fitBounds(layer.getBounds(), { padding: [20, 20] });
            setTimeout(() => {
              layer.openPopup();
            }, 500);
          }
        };
        container.appendChild(button);
      });
    }

    // ì¶©ë‚¨ ì§€ì—­ ê²½ê³„ ë°ì´í„° (ê°„ë‹¨í•œ ì¢Œí‘œë¡œ ëŒ€ì²´)
    const chungnamBounds = {
      'ì²œì•ˆì‹œ': [[36.8151, 127.1139], [36.8451, 127.1539]],
      'ê³µì£¼ì‹œ': [[36.4465, 127.1189], [36.4765, 127.1589]],
      'ë³´ë ¹ì‹œ': [[36.3328, 126.6127], [36.3628, 126.6527]],
      'ì•„ì‚°ì‹œ': [[36.7898, 127.0021], [36.8198, 127.0421]],
      'ì„œì‚°ì‹œ': [[36.7848, 126.4503], [36.8148, 126.4903]],
      'ë…¼ì‚°ì‹œ': [[36.1872, 127.0986], [36.2172, 127.1386]],
      'ê³„ë£¡ì‹œ': [[36.2743, 127.2489], [36.3043, 127.2889]],
      'ë‹¹ì§„ì‹œ': [[36.8927, 126.6279], [36.9227, 126.6679]],
      'ê¸ˆì‚°êµ°': [[36.1089, 127.4888], [36.1389, 127.5288]],
      'ë¶€ì—¬êµ°': [[36.2760, 126.9100], [36.3060, 126.9500]],
      'ì„œì²œêµ°': [[36.0817, 126.6919], [36.1117, 126.7319]],
      'ì²­ì–‘êµ°': [[36.4594, 126.8025], [36.4894, 126.8425]],
      'í™ì„±êµ°': [[36.6015, 126.6606], [36.6315, 126.7006]],
      'ì˜ˆì‚°êµ°': [[36.6826, 126.8472], [36.7126, 126.8872]],
      'íƒœì•ˆêµ°': [[36.7456, 126.2981], [36.7756, 126.3381]]
    };

    // ì§€ë„ì— ì§€ì—­ í‘œì‹œ
    function drawRegions() {
      // ê¸°ì¡´ ë ˆì´ì–´ ì œê±°
      Object.values(regionLayers).forEach(layer => {
        map.removeLayer(layer);
      });
      
      Object.keys(issueData).forEach(regionName => {
        const bounds = chungnamBounds[regionName];
        if (bounds) {
          const data = issueData[regionName];
          const color = getColorByImportance(data.ì¤‘ìš”ë„);
          
          // ì‚¬ê°í˜•ìœ¼ë¡œ ì§€ì—­ í‘œì‹œ
          const rectangle = L.rectangle(bounds, {
            color: '#333',
            weight: 2,
            fillColor: color,
            fillOpacity: 0.6
          });
          
          rectangle.addTo(map);
          
          // íŒì—… ì¶”ê°€
          const popupContent = createPopupContent(regionName, data);
          rectangle.bindPopup(popupContent, {
            maxWidth: 400,
            className: 'custom-popup'
          });
          
          // ì§€ì—­ëª… ë¼ë²¨ ì¶”ê°€
          const center = rectangle.getBounds().getCenter();
          const label = L.marker(center, {
            icon: L.divIcon({
              className: 'region-label',
              html: `<div style="background: rgba(255,255,255,0.9); padding: 2px 6px; border-radius: 3px; font-size: 11px; font-weight: bold; text-align: center; border: 1px solid #333; box-shadow: 0 1px 3px rgba(0,0,0,0.3);">${regionName}</div>`,
              iconSize: [60, 20],
              iconAnchor: [30, 10]
            })
          });
          
          label.addTo(map);
          
          regionLayers[regionName] = rectangle;
          if (!allRegions.includes(regionName)) {
            allRegions.push(regionName);
          }
        }
      });
      
      renderRegionButtons(allRegions);
    }

    // ì „ì—­ í•¨ìˆ˜ë¡œ ë“±ë¡ (popupì—ì„œ ì‚¬ìš©í•˜ê¸° ìœ„í•´)
    window.handleIssueClick = handleIssueClick;

    // ì´ˆê¸°í™”
    loadCSVData();

    // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
    map.on('click', function(e) {
      console.log('ì§€ë„ í´ë¦­ ì¢Œí‘œ:', e.latlng);
    });
  </script>
</body>
</html>